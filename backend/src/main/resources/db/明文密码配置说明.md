# 明文密码配置说明

## 概述

系统已配置为使用明文密码存储和验证。用户输入的密码会直接与数据库中存储的明文密码进行比较，匹配即可登录。

## 已完成的修改

### 1. 创建 PlainTextPasswordEncoder
- 文件: `backend/src/main/java/com/example/culturalxinjiang/security/PlainTextPasswordEncoder.java`
- 功能: 实现明文密码的编码和验证，直接进行字符串比较

### 2. 修改 SecurityConfig
- 文件: `backend/src/main/java/com/example/culturalxinjiang/security/SecurityConfig.java`
- 修改: 将 `BCryptPasswordEncoder` 替换为 `PlainTextPasswordEncoder`

### 3. 禁用 PasswordMigrationRunner
- 文件: `backend/src/main/java/com/example/culturalxinjiang/config/PasswordMigrationRunner.java`
- 修改: 注释掉 `@Component` 注解，防止自动加密明文密码

### 4. AuthService 自动适配
- 注册时: 使用 `passwordEncoder.encode()` 存储明文密码
- 登录时: 使用 `passwordEncoder.matches()` 进行明文比较

### 5. UserService 自动适配
- 修改密码时: 使用 `passwordEncoder.encode()` 存储明文密码
- 验证原密码: 使用 `passwordEncoder.matches()` 进行明文比较

## 数据库配置

### 将现有密码转换为明文

如果数据库中的密码是 BCrypt 格式，需要先转换为明文：

```sql
USE cultural_xinjiang;

-- 将所有用户的密码设置为明文 "123456"
UPDATE users
SET password = '123456'
WHERE username IN ('admin', 'user1', 'user2');

-- 验证更新结果
SELECT 
    id,
    username,
    email,
    CASE 
        WHEN password = '123456' THEN '✓ 明文密码'
        WHEN password LIKE '$2a$%' THEN '✗ BCrypt格式（需要更新）'
        ELSE '其他格式'
    END AS password_status,
    password AS password_value
FROM users
WHERE username IN ('admin', 'user1', 'user2');
```

或者使用提供的 SQL 脚本：
- `backend/src/main/resources/db/convert-to-plaintext.sql`

## 使用说明

### 登录
- 用户名: `admin`
- 密码: `123456`（与数据库中的明文密码完全匹配）

### 注册新用户
- 新用户注册时，密码会以明文形式存储到数据库
- 登录时直接比较明文密码

### 修改密码
- 用户修改密码时，新密码会以明文形式存储
- 验证原密码时直接进行字符串比较

## 重要提示

⚠️ **安全警告**: 
- 明文密码存储仅适用于开发环境或内部系统
- 生产环境强烈建议使用 BCrypt 等加密方式
- 明文密码存在安全风险，请谨慎使用

## 恢复 BCrypt 加密

如果需要恢复 BCrypt 加密：

1. 修改 `SecurityConfig.java`:
   ```java
   @Bean
   public PasswordEncoder passwordEncoder() {
       return new BCryptPasswordEncoder();  // 恢复 BCrypt
   }
   ```

2. 启用 `PasswordMigrationRunner`:
   ```java
   @Component  // 取消注释
   public class PasswordMigrationRunner implements CommandLineRunner {
       // ...
   }
   ```

3. 重启应用，自动迁移会将明文密码转换为 BCrypt 哈希值

## 测试验证

1. **执行 SQL 脚本**将密码转换为明文
2. **重启后端应用**
3. **测试登录**:
   - 用户名: `admin`
   - 密码: `123456`
4. **验证功能**:
   - 登录成功
   - 注册新用户
   - 修改密码

## 技术细节

- `PlainTextPasswordEncoder.encode()`: 直接返回原始密码字符串
- `PlainTextPasswordEncoder.matches()`: 使用 `String.equals()` 进行比较
- Spring Security 的 `DaoAuthenticationProvider` 会自动使用配置的 `PasswordEncoder`
- 所有密码相关操作（注册、登录、修改密码）都会自动使用明文编码器




